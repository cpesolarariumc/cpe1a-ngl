<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Send a Message | CPE 1-A</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="profile-section">
            <div class="avatar-container">
                <img src="1A.jpg" alt="CPE 1-A Profile">
            </div>
            <div class="username">CPE 1-A</div>
        </div>

        <div class="glass-card">
            <p style="opacity: 0.8; font-size: 1rem; margin-bottom: 20px; font-weight: 600;">
                send an anonymous message to us!
            </p>
            
            <form id="send-form">
                <textarea id="msg" placeholder="type your secret..." required maxlength="300"></textarea>
                <button type="submit" id="submit-btn" class="send-btn">Send Anonymous</button>
            </form>
            
            <p id="success" style="display:none; margin-top: 15px; color: var(--accent); font-weight: bold;">
                âœ¨ Sent into the void!
            </p>
        </div>
    </div>

    <script type="module">
        import { firebaseConfig } from './config.js';
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Initialize Firebase using your config.js
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const sendForm = document.getElementById('send-form');
        const submitBtn = document.getElementById('submit-btn');
        const successMsg = document.getElementById('success');

        sendForm.onsubmit = async (e) => {
            e.preventDefault();
            
            // Visual feedback
            submitBtn.innerText = "Sending...";
            submitBtn.disabled = true;
            
            const text = document.getElementById('msg').value;
            
            try {
                // Send to Firestore
                await addDoc(collection(db, "messages"), { 
                    content: text, 
                    timestamp: serverTimestamp() 
                });
                
                // Reset form and show success
                sendForm.reset();
                successMsg.style.display = 'block';
                setTimeout(() => { successMsg.style.display = 'none'; }, 3000);
            } catch (error) {
                console.error("Error:", error);
                alert("Message failed to send. Check your connection.");
            } finally {
                submitBtn.innerText = "Send Anonymous";
                submitBtn.disabled = false;
            }
        };
    </script>
</body>
</html>